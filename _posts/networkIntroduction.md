# 互联网及物联网科普

>仅以本文纪念曾经美好的80天

## 概要
互联网已是现代生活不可缺少的一部分，随之而来的物联网也是可预见的下一次技术革命。物联网可以说是互联网的延伸，它主要是将更多的物品纳入现有的网络，使物与人，物与物建立更广泛的连接，而不仅仅是人与人的连接(互联网)。因此对于每个人来说大致了解物联网与互联网底层网络的组建方式及核心思想就变的十分有意义了。  

本文旨在向非专业人士从以下几个方面介绍网络：  
1. 网络是如何组建的
2. 网络中的协议
3. 网络的分层思想


在介绍完网络后本文会介绍**互联网的发展历史**。参照互联网的发展，作者表达了对**当前物联网的看法**，最后**畅享了未来的物联网**

## 声明
1. 本文中所有内容仅为作者总结或思考，请大家以辩证的眼光看待。
2. 本文旨在向非计算机专业人士进行科普，因此对相关概念进行了高度简化。
3. 为了便于理解，本文中提到的路由器泛指：路由器，交换机，网桥，中继器甚至还有调制解调器。

## 网络解决了什么问题
在介绍网络前，通常我们应该先定义下什么是网络。但是为避免枯燥的概念，我们从网络解决了什么问题入手，对网络进行最直观的描述。作者认为**网络解决的是一个终端向另一个终端传输数据的问题**。通过网络，我们可以将一个终端的数据传输给另一个终端。这里的终端可以是手机、电脑、智能烟感、服务器等。例如：通过网络我们可以用手机向Google服务器发发送查询请求，Google服务器再通过网络将结果数据告诉我们。电脑通过网络从另一台电脑上下载（P2P）音乐数据。智能烟感通过网络向我们的手机发送告警数据。  
![图片1]("")

## 网络是如何组建的
在回答了网络解决什么样的问题后，下面来回忆下平时我们是如何使用网络的。  
在使用手机上网时，只要连接电信运营商的基站(基站会连接运营商路由器)即可浏览互联网上的内容。  
在家中上网时，需要联系电信运营商牵1根入户网线，网线连接家中的无线路由器，家中各种设备连接路由器后即可上网。如果仅仅是和家人玩局域网游戏（红色警戒2），那么只要家人的电脑也连接同一个路由器即可。  
在物联网环境下，则大体可以分为2类。1、传感器只需要与中继器交互数据。比如工厂内的温湿度传感器，只需要定期将数据回写给同网络的服务器中。或者使用lora协议的传感器仅与中继器交互数据。（中继器可以与连接电信运营商的路由器相连继续将数据上传到网络的云平台中）。2、传感器需要和全网络中任意设备通信。比如含有电信运营商SIM卡的共享单车，需要通过网络接收开锁，还车，变更密码等指令数据。智能家电连接无线路由器后与网络中的手机交互数据。  
![图片2]("")  

从上面列举的例子我们可以看出，我们使用网络的方式大致分为2种：1、交互双方的两个设备在同一个路由器下（局域网游戏，物联网第一种情况），路由器可以帮我们把数据转发数据。2、交互的设备不在同一个路由器下，但是设备连接的路由器必定与电信运营商相连。  
在所有例子中都大量涉及到了路由器，我们可以简单的将**路由器的功能定义为将数据转发**。它可以从与之相连的1个设备中获得数据并转发给另一个与之相连的设备。这样第一种网络使用方式就很好理解了。通过路由器实现了网络传输数据的功能。现在我们主要来看使用网络的第二种方式。  
![图片3]("")  

对于第二种使用网络的方式，直观的感受是我们的路由器连接电信运营商后就与网络中其它所有设备相连了。其实在运营商网络中，我们首先也是与路由器相连。当家中的路由器发现目标设备没有与其相连时，就会将数据转发给电信运营商的路由器，该路由器会查看目标设备时候与本路由器相连，如果有则直接转发给目标设备，如果没有则会将数据转发给它认为最有可能连接这个设备的路由器。这样反复直到最终数据传输到对应设备上。在这个过程中数据转发寻址的依据就是我们常数的IP地址了。  
![图片4]("")  

肯定有人就会问了难道中国电信是宇宙第一网络运行商，可以覆盖整个网络？其实当然不是，网络运营商（ISP）只负责本地的设备的网络接入，但运营商之间是互相连通同时是有等级的，一种较为好理解的方式是按照地域分级。北京的用户连接北京的网络运营商，各个省的运营商与国家级运营商相连，各个国家级运营商互相连通。越是高层的运营商互联时速度越快。同时各个网络运营商有分配IP地址的权利，有了IP就可以通过路由转发将数据发送给网络中任意1台设备了。由于运营商就有地域性，因此IP其实也是具有一定地域性的。（某些[网站]("https://www.ip138.com/")可以显示你的上网地域）这也就是为什么路由器根据IP可以将数据转发到尽可能距离设备近的路由器上（为了方便理解，此处不是很严谨）。  
![图片5]("")  

这里顺带说一句，网络运营商分配的IP一般是**公网IP**，全网唯一，用它可以路由到全网任意一个其他公共IP。而我们在网络第一种使用方式中，相关设备没有访问全网其他IP的需要，这时就不用向网络运营商申请公网IP，使用**私有IP**组网就可以了 ，这种IP仅仅用作专用网内寻址。一般"10.XX.XX.XX"，"172.16.XX.XX~172.31.XX.XX"，"192.168.XX.XX"的IP都是私有IP。
总结来说网络是如何帮我们终端上的数据传输给其他其他终端的呢？就是运用IP寻址，通过路由器一跳一跳的转发到拥有目的IP的终端上的。  
![图片6]("")  

## 网络协议
本节我们来介绍一个时髦的词——协议。什么是协议？协议是用来干什么的？本节将给出答案。  
其实我们生活中无时无刻不在执行协议。考虑当你想要向某人询问时间时一般会怎么做？图7显示了一种典型的交互过程。  
![图片7]("")  

人类的协议要求一方首先进行问候（如“你好”），以开始与另一个人的通信。对“你好”的典型响应是返回一个“你好”。此人用一个热情的"你好"进行响应，隐含着一种指示，表明能够继续向那人询问时间了。对最初的“你好”的不同响应（如：“别来烦我！”，“哦”）也许表明了一个勉强的或不能进行的通信。同样，有时问的问题根本得不到任何回答。在此情况下，按照人类的协议，发话者就不会再询问时间了。在我们人类协议中，有我们发送的特定报文，也有我们根据接收到的应答报文或其他事件采取的行动。显然，发送和接收的报文，以及这些报文发送和接收或其他事件出现时所采取的动作，这些在一个人类协议中起到了核心作用。如果人们使用不同的协议，比如一个人讲礼貌，一个人不讲礼貌，一个人说中文，一个人说英文，就会导致协议不能交互，因而不能完成有用的工作。  
在网络中这个思路同样成立。网络协议类似与人类的协议，除了交换报文和采取动作的实体从人变味了某些设备（手机、电脑、路由器等）的硬件或软件组件。在因特网中，涉及两个或多个远程通信实体的所有活动都受协议的制约。  
以大家可能熟悉的一个网络使用场景（主要涉及TCP和HTTP协议）为例，考虑当你向一个web服务器发送请求（在web浏览器中访问网页的场景）时发送的情况（图7右半部分）。首先，你的计算机将向web服务器发送一条连接请求报文，并等待回答。该web服务器将最终能接收到连接请求报文（中途经过多个路由转发），并返回一条连接响应报文。得知请求该web服务正常以后，计算机则会发送1条HTTP的GET报文，向服务器申请获取名为"www.baidu.com"的文档。最后，WEB服务器想计算机返回该文档（网页）。  
从上述人类或网络活动例子中可见，报文的交换以及发送和接收这些报文时所采取的动作是定义一个协议的关键元素：
```
协议定义了两个或多个通信实体之间交换数据的格式和顺序，以及服务器发送、接收报文或其他事情应采取的动作。
```  
在网络中广泛的使用了协议，不同的协议用于完成不同的通信任。了解计算机网络领域知识的过程就是理解网络协议的构成、原来和工作方式的过程。  

## 协议层次及服务模型
在“网络是如何组建的”这一节的最后，我们粗略的了解了，网络是如何帮助我们进行数据传输的（多个路由器转发）。在网络实现层面上，实际上是**十分复杂**的。比如，我们不同的应用场景肯定会定义不同的数据格式以便应对不同的业务场景。浏览网页用的协议是浏览器可以读懂HTTP（超文本连接）协议，而发送邮件就必须得用SMTP（简单邮件传输）协议。使用迅雷下载数据使用P2P（点对点传输）协议，资源被下载的越多速度越快。而正常的从固定文件服务器上下载文件一般使用FTP（文件传输协议）协议，人越多下载越慢。我们应用程序的数据在经过多个路由到达目的终端的过程中，网络需要保证数据证正确传输，保证收发双方速度匹配以及实现拥塞控制机制等。在路由器转发的过程，需要路由选择协议保证根据IP地址数据包可以正确的被转发到目标终端。由于设备与路由器之间，路由器与路由器之间连接的方式不同（光纤、无线、电缆；3G、4G、lora、zigBee），就需要不同的协议保证两个节点之间数据正常传输。  
那么我们如何跟如此复杂的网络打交道呢？我们在做业务时需要了解所有细节么？答案当然是，不用了解所有细节。下面我们再以生活中的一个例子来看看我们平时是如何讨论、设计复杂系统的。  
比如你1份文件要用快递寄从B市给国外在H市的合作伙伴，这件事是如何实现的呢？首先我们只用对接1个快递公司，遵照邮件邮寄重要文件的要求将文件装入信封。快递小哥将邮件投递到B市的中转站，中转站根据地址决定将你的邮件中转到S市国际中转站，然后将所有去往S市的信件打成包裹，交给铁路公司使用火车运输。铁路负责安全的将装有包裹集装箱从B市运送到S市。S市国际中转站收到邮件后根据地址，又将邮件放入了寄往H市的包裹中，并交给航空公司负责运输。航空公司生成集装箱有飞机负责将集装箱运达H市并将包裹交给H市中转站。H市中转站从包裹中拿出信件，根据地址交给你的合作伙伴。  
![图片8]("")  

在整个流程中，你和客户之间完成了文件的流转，而你和客户不必操心快递公司是如何中转的，过程中使用了何种交通工具等这些实际传输的细节。快递公司之间完成的是包裹的流转，他不需要关心，火车站、机场是如何安排车次，保证飞机和火车正常运作的。而机场或火车站也不关心集装箱的内容，只要保证准时安全的完成集装箱的运送就好了。在这个模型里，每一层（客户与你；所有中转站；机场之间，火车站之间）都完成了与他们对等层的数据交换，同时每一层也只用考虑如何与下层结合而不用考虑整个流程的各个细节。抽象的说，每一层通过以下方式提供服务：1、在这层执行某些动作（火车从B市开往S市，B市中转站将信件转发给S市）；2、直接使用下层服务（中转站使用火车运输或航空运输，我们使用快递服务）。  

上述事例就是利用分层的思路，讨论了复杂的物流运输系统。这种思路将每一层的服务模块化。只要该层对上层提供相同服务，并且使用来自下层次的相同服务，当某层的实现变化时，该系统其余部分可保持不变。比如中转站信件分拣及打包工作由人工变成了机器，这对整个文件的流转是没有影响的。对于大而复杂且需要不断更新的系统，分层的这种各层改变实现方式不影响整体运行的特点就十分符合需求了。    

现在我们将注意力重新回到计算机网络上。其实刚才的物流模型和网络模型有诸多相似之处。特别是关于分层的思想。先贤们在设计网络时就广泛使用了协议分层的思想。他们将整个网络系统划分成了5层，由下到上分别是：物理层、链路层，运输层和应用层。每一层通过在该层中执行某些动作或使用直接下层的服务来提供服务，服务内容由各种协议来定义。因此计算机网络就体现为，从上到下分成了5层，每层有1到多个协议定义提供服务的方式及标准。根据各种协议，世界各个厂商可以根据实际场景自行完成实现。各层通过协议互相衔接完成数据传递的功能。  
