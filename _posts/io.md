---
title: 再谈阻塞与非阻塞，同步与异步
categories:
- JAVA,操作系统
tags:
- 网络IO,java bio,java nio,java aio,同步,异步,阻塞,非阻塞
---
# 前言
作为程序猿经常会听到阻塞非阻塞，同步异步的概念，前辈也经常告诫我们这些概念是经常会使用到的，面试经常会问。但是其实到最近我才对这些概念有了比较清晰的认识并发现，其实网上大部分解释都比较片面没有说清楚，特别是那个经典的烧开水例子，什么一会来看一会不来看，一会水壶响一会水壶不响，在我现在看来那篇文章仅仅是举的例子比较有意思但缺少讲解，问题来龙去脉也没有解释清楚。因此在这里分享一些自己的看法如果不对还请各位指出。

# 概要

<!-- more -->

# 定题
首先我们来确定问题。如果一个面试官直接让你解释同步与异步,阻塞与非阻塞这几个概念，那我可以说这个面试官问法是相当有问题的。因为同步，异步，阻塞，非阻塞是形容词，不是名词。我们只有将这几个形容词放在相应的上下文或者确定其描述的主体在来解释才有意义。那么同步，异步，阻塞，非阻塞是描述什么的呢？

根据我的了解其实这些词在大部分语境描述的是`网络IO模型`。nginx和netty所号称的异步非阻塞，其实是说它们网络IO模型是异步非阻塞的。下面我们来解释下Linux的IO模型，来看看在描述IO模型时者四个形容词到底指的是什么。

# Linux I/O模型

## 概念
为了说清楚Linux I/O模型，我们需要先搞清楚一些概念。

**首先什么是操作系统？**我认为**操作系统是向下屏蔽硬件资源的差异，向上为用户提供统一资源服务**。这些硬件资源主要包括磁盘资源，内存资源和CPU资源。提供的对应服务有读写磁盘上文件的I/O服务，内存服务（逻辑地址映射为实际物理地址、进程间内存隔离等），为进程线程分配计算资源的CPU调度服务。在与外部设备结合后操作系统的IO服务其实覆盖面非常大。比如借助网卡我们可以读写非本地磁盘的文件，这也就是我们常说的网络I/O服务。  

Linux操作系统的**用户空间**和**内核空间**。操作系统在提供内存服务时，为了保护操作系统使用的内存绝对不会被用户程序破坏。将操作系统内核使用的内存空间叫作内核空间，将其它应用使用的内存空间叫作用户空间。  

**进程状态**，进程在CPU上运行时，主要会出现3种状态(细分还有5状态，7状态)，分别是就绪，运行，阻塞。当进程资源准备齐全等待CPU时间片时进程进入就绪状态，当获取CPU时间后进入运行状态，运行时间消耗完再次进入就绪状态，在运行时缺少资源（网络数据）则进入阻塞状态，在阻塞时获取到全部资源则进入就绪状态。  

**缓存IO**，缓存I/O又被称作标准I/O，大多数文件系统的默认I/O操作都是缓存I/O，即基于缓存进行I/O操作。在Linux的缓存I/O机制中，操作系统会将I/O的数据缓存在文件系统的页缓存（page cache）中，也就是说，数据会先被拷贝到操作系统内核的缓冲区中（内核空间），然后才会从操作系统内核的缓冲区拷贝到应用程序的地址空间（用户空间）。

## 网络I/O模型
在大致了解了以上概念后，我们开说说Linux为我们提供的I/O模式，即I/O的操作方式。首先再次强调，操作系统在向用户程序提供I/O服务时大体需要分为2个步骤，从磁盘或网卡等硬件中读取数据到内核空间的缓冲区中，或称成为等待数据就绪。从内核空间的数据拷贝到用户空间供程序使用。  

由于分未这两个阶段以及网络I/O的特殊性，linux为用户程序提供了5种网络I/O处理的方案：
* 阻塞 I/O（blocking IO）
* 非阻塞 I/O（nonblocking IO）
* I/O 多路复用（ IO multiplexing）
* 信号驱动 I/O（ signal driven IO）
* 异步 I/O（asynchronous IO）

### 阻塞 I/O（blocking IO）

